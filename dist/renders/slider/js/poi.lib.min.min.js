!function(t,e){"function"==typeof define&&define.amd?define([],e(t)):"object"==typeof exports?module.exports=e(t):t.atomic=e(t)}("undefined"!=typeof global?global:this.window||this.global,function(n){"use strict";var s,t={},r=!!n.XMLHttpRequest&&!!n.JSON,o={type:"GET",url:null,data:{},callback:null,headers:{"Content-type":"application/x-www-form-urlencoded"},responseType:"text",withCredentials:!1},i=function(){for(var a={},t=0;t<arguments.length;t++){!function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&("[object Object]"===Object.prototype.toString.call(t[e])?a[e]=i(!0,a[e],t[e]):a[e]=t[e])}(arguments[t])}return a},c=function(t){if("string"==typeof t)return t;if(/application\/json/i.test(s.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(t))return JSON.stringify(t);var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e.join("&")},l=function(){var e={success:function(){},error:function(){},always:function(){}},a={success:function(t){return e.success=t,a},error:function(t){return e.error=t,a},always:function(t){return e.always=t,a}},n=new XMLHttpRequest;for(var t in n.onreadystatechange=function(){if(4===n.readyState){var t=function(e){var a;if("text"!==s.responseType&&""!==s.responseType)return[e.response,e];try{a=JSON.parse(e.responseText)}catch(t){a=e.responseText}return[a,e]}(n);200<=n.status&&n.status<300?e.success.apply(e,t):e.error.apply(e,t),e.always.apply(e,t)}},n.open(s.type,s.url,!0),n.responseType=s.responseType,s.headers)s.headers.hasOwnProperty(t)&&n.setRequestHeader(t,s.headers[t]);return s.withCredentials&&(n.withCredentials=!0),n.send(c(s.data)),a};return t.ajax=function(t){if(r)return"jsonp"===(s=i(o,t||{})).type.toLowerCase()?(e=n.document.getElementsByTagName("script")[0],a=n.document.createElement("script"),s.data.callback=s.callback,a.src=s.url+(s.url.indexOf("?")+1?"&":"?")+c(s.data),e.parentNode.insertBefore(a,e),void(a.onload=function(){this.remove()})):l();var e,a},t}),window.POI=function(t){this.images=[],this.imgsLoaded=0,this.params=t},window.POI.prototype={generateData:function(t){var e,a=this,n=a.getHotspots(t.data);if(null!==n){var s=a.findImg(t.img,a.params);e={dimensions:{width:t.data.width,height:t.data.height},$img:s,data:t.img,name:t.img.name,points:n,svg:null},a.images.push(e)}a.imgsLoaded+=1,t.callback(e)},getImgData:function(a){for(var n=this,s=this.params.images,t=0;t<s.length;t++)!function(){var e=t;s[e].data?n.generateData({data:s[e].data,img:s[e],callback:function(t){a(t)}}):atomic.ajax({url:n.params.domain+"/i/"+n.params.account+"/"+s[e].name+".json?metadata=true&func=amp.jsonReturn&v="+(new Date).getTime()}).success(function(t){n.generateData({data:t,img:s[e],callback:function(t){a(t)}})}).error(function(t){console.error("Image failed to load",t)})}()},findImg:function(t){for(var e=document.querySelectorAll("img."+this.params.imgClass),a=this.params.imgAttribute||"src",n=null,s=0;s<e.length;s++){var r=new RegExp(t.name),o=e[s].getAttribute(a).match(r);if(o&&0<o.length){n=e[s];break}}return n},getHotspots:function(t){var e=null;t.constructor!==Array&&(t=[t]);for(var a=0;a<t.length;a++)t[a]&&t[a].metadata&&t[a].metadata.hotSpots&&t[a].metadata.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots&&t[a].metadata.hotSpots.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots.list&&0<t[a].metadata.hotSpots.hotSpots.list.length&&(e=t[a].metadata.hotSpots.hotSpots.list);return e},iteratePoints:function(t){if(t)for(var e=this.hotspots(),a=this.areaInterest(),n=t.points,s=0;s<n.length;s++)n[s].points.constructor===Array?a.create(n[s],t):e.create(n[s],t)},assignEvents:function(t,a,n,s){if(n&&0<n.length)for(var r=0;r<n.length;r++)!function(){var e=n[r];e.target!==a&&"*"!==e.target||(t.addEventListener(e.action,function(t){e.callback(t,s)},!1),e.initCallback&&e.initCallback(s))}()},init:function(){var e=this;this.getImgData(function(t){e.iteratePoints(t)})}},"object"==typeof exports&&(module.exports=POI),POI.prototype.dom={hasClass:function(t,e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)},getClosest:function(t,e){var a,n,s=e.charAt(0),r="classList"in document.documentElement;for("["===s&&(1<(a=(e=e.substr(1,e.length-2)).split("=")).length&&(n=!0,a[1]=a[1].replace(/"/g,"").replace(/'/g,"")));t&&t!==document&&1===t.nodeType;t=t.parentNode){if("."===s)if(r){if(t.classList.contains(e.substr(1)))return t}else if(new RegExp("(^|\\s)"+e.substr(1)+"(\\s|$)").test(t.className))return t;if("#"===s&&t.id===e.substr(1))return t;if("["===s&&t.hasAttribute(a[0])){if(!n)return t;if(t.getAttribute(a[0])===a[1])return t}if(t.tagName.toLowerCase()===e)return t}return null}},POI.prototype.hotspots=function(){var l=this;return{create:function(t,e){var a=e.data.hotspotCallbacks,n=document.createElement("div"),s=t.selector,r=t.target;if(s){0===s.indexOf(".")?(s=s.slice(1),n.setAttribute("class",s)):0===s.indexOf("#")?(s=s.slice(1),n.setAttribute("id",s)):n.setAttribute("class",s);var o=l.dom.getClosest(e.$img,"."+l.params.containerClass);if(o&&l.dom.hasClass(o,l.params.containerClass)){var i=t.points.x.toString().slice(2);i=i.substr(0,2)+"."+i.substr(2);var c=t.points.y.toString().slice(2);c=c.substr(0,2)+"."+c.substr(2),n.style.position="absolute",n.style.left=i+"%",n.style.top=c+"%",o.style.position="relative",o.appendChild(n),r&&0<r.length&&(n.setAttribute("data-target",r),l.assignEvents(n,r,a,{$image:e.$img,$target:n,$parent:o,hotspot:t,imgInfo:e}))}else console.warn("No parent with specified className "+l.params.containerClass+" was found.")}else console.warn("no selector specified")}}},POI.prototype.areaInterest=function(){var p=this;return{create:function(t,e){var a=e.data.areaCallbacks,n=t.selector;if(n){var s,r=t.target,o=p.dom.getClosest(e.$img,"."+p.params.containerClass),i="http://www.w3.org/2000/svg",c=document.createElementNS(i,"g"),l=document.createElementNS(i,"polygon");if(e.svg?s=e.svg:((s=document.createElementNS(i,"svg")).setAttributeNS(null,"viewBox","0 0 "+e.dimensions.width+" "+e.dimensions.height),o.appendChild(s),e.svg=s),0===n.indexOf(".")?(n=n.slice(1),l.setAttributeNS(null,"class",n)):0===n.indexOf("#")?(n=n.slice(1),l.setAttributeNS(null,"id",n)):l.setAttributeNS(null,"class",n),o&&p.dom.hasClass(o,p.params.containerClass)){var u="";t.points.forEach(function(t){u+=e.dimensions.width*t.x+","+e.dimensions.height*t.y+" "}),l.setAttributeNS(null,"points",u),s.appendChild(c),c.appendChild(l),r&&0<r.length&&(l.setAttributeNS(null,"data-target",r),p.assignEvents(c,r,a,{$image:e.$img,$target:c,$parent:o,area:t,imgInfo:e}))}else console.warn("No parent with specified className "+p.params.containerClass+" was found.")}else console.warn("no selector specified")}}};